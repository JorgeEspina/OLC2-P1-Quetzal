<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!--<link rel="icon" href="%PUBLIC_URL%/favicon.ico" />-->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <!-- CSS only -->
    <link rel="stylesheet" href="https://bootswatch.com/4/darkly/bootstrap.min.css">
    <script src="css/lib/codemirror.js"></script>
    <script src="css/addon/edit/closetag.js"></script>
    <script src="css/javascript/javascript.js"></script>
    <link href="css/lib/codemirror.css" rel="stylesheet"/>
    <link href="css/theme/erlang-dark.css" rel="stylesheet"/>
    <link href="css/theme/isotope.css" rel="stylesheet"/>
    <link href="css/theme/darcula.css" rel="stylesheet"/>
    <link href="css/theme/dracula.css" rel="stylesheet"/>
    <link rel="stylesheet" href="AST/chart/chart.css">
     <!-- GRAMMAR FOR GRAPH -->
     <script src="Gramatica/gramatica.js"></script>
    <title>Quetzal Grupo #40</title>
  </head>
  <body>
    <div><p></p></div>
    <div class="container-fluid">
        <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
            <ul class="navbar-nav">
                <li class="nav-item" href="AST.html">
                    <input type="file" name="" class="btn btn-block btn-md btn-outline-warning" id="open-file" >
                </li>
                <!--<li class="nav-item">
                    <input type="button" value="Guardar Archivo" class="btn btn-block btn-md btn-outline-light" id="BtnGuardarArchivo">
                </li>-->

                <li class="nav-item">
                    <input type="button" value="Compilar" class="btn btn-block btn-md btn-outline-success" id="BtnCompilar">
                </li>

                <li class="nav-item">
                    <a href="TablaSimbolos.html" class="btn btn-block btn-md btn-outline-info"  id="BtnTablaSimbolos">Tabla de Simbolos</a>  
                </li>

                <li class="nav-item">
                    <a class="btn btn-block btn-md btn-outline-danger" id="BtnReporteErrores">Reporte de Errores</a>  
                </li>

                <li class="nav-item">
                    <a href="AST.html" class="btn btn-block btn-md btn-outline-warning">Arbol AST</a>                    
                </li>
                <li class="nav-item">
                    <a href="#" class="btn btn-block btn-md btn-outline-primary">Reporte Gramatical</a>                    
                </li>
            </ul>
        </nav>
       
        <p>  </p>
        <hr>
        <div class="row justify-content-md-center">
            <div class="col-md-6 ">
                <h5 align="center">Editor</h5>
            </div>
            <div class="col-md-6">
                <h5 align="center">Salida</h5>
            </div>
        </div>
        <p></p>
        <div class="row justify-content-md-center">
            <div class="col-md-6 justify-content-md-center">
                <div  class="jumbotron">
                    <textarea id="Fuente"></textarea>
                </div>
            </div>
            <div  class="col-md-6 justify-content-md-center">
                <div class="jumbotron">
                    <textarea id="Salida"></textarea>
                </div>
            </div>
        </div>
        <div class="row justify-content-md-center">
            <div class="col-md-6">
                <h5 align="center">Consola</h5>
            </div>
            <div class="col-md-8">
                <div  class="jumbotron">
                    <textarea id="Consola"></textarea>
                </div>
            </div>
           
        </div>
        <div class="row justify-content-md-center">
            <div class="col-12">
              <div _ngcontent-pyl-c58="" id="graph-container" name="graph-container" style="text-align: center">
                    
              </div>
            </div>  
            <div class="container" id="ShowReportErrors">
                <div class="row justify-content-md-center">
                    <div class="col col-sm-12 col-md-10 col-lg-10 col-xl-10" id="ReportErrors">
                        
                    </div>
                </div>
            </div>   
        </div>
        <div class="container" id="showTableErrors">
            <div class="row justify-content-md-center">
                <div class="col col-sm-12 col-md-10 col-lg-10 col-xl-10" id="tableErrors">
                    
                </div>
            </div>
        </div>
    </div>  
    <!-- ACCIONES-->
    <script type="text/javascript" src="Gramatica/gramatica.js"></script>
    <!--<script type="text/javascript" src="Acciones.js"></script>-->

    <!-- Utils-->
    <script src="Utils/EnvironmentType.js"></script>
    <script src="Utils/ErrorList.js"></script>
    <script src="Utils/PrintConsole.js"></script>
    <script src="Utils/ErrorType.js"></script>

    <!-- ABSTRACT -->   
    <script src="Struct/Abstract/Node.js"></script>
    <script src="Struct/Abstract/ErrorNode.js"></script>
    <script src="Struct/Abstract/Instruction.js"></script>

    <!-- Instruccions-->
    <script src="Instrucciones/InstructionError.js"></script>

    <!-- load the d3.js library -->    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>   
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@1,500&display=swap" rel="stylesheet">
    <script src="AST/chart/chart.js"></script>
    <script>
        
        var openFile = document.getElementById("open-file");
        openFile.addEventListener("change", (event) => {
        const fileUpload = event.target.files;
        console.log(fileUpload);

        if (fileUpload.lenght == 0) {
            alert("Error: Seleccione un archivo");
            return;
        }

        var reader = new FileReader();
        reader.addEventListener("load", function (e) {
            var text = e.target.result;
            //var editor = getEditor();
            Fuente.setValue(text);
        });
        reader.readAsText(fileUpload[0]);
        });

        var Fuente = CodeMirror.fromTextArea(document.getElementById('Fuente'),{
            mode: "javascript",
            theme: "darcula",
            lineNumbers: true,
            autoCloseTags: true,
        });
        Fuente.setSize("770","400");
        var Salida = CodeMirror.fromTextArea(document.getElementById('Salida'),{
            mode: null,
            theme: "dracula",
            lineNumbers: true,
            autoCloseTags: true,
            readOnly: true
        });
        Salida.setSize("770","400");

        var Consola = CodeMirror.fromTextArea(document.getElementById('Consola'),{
            mode: null,
            theme: "isotope",
            lineNumbers: true,
            autoCloseTags: true,
            readOnly: true
        });
        Consola.setSize("1170","300");

        function Compile(texto){
            Salida.setValue("");
            Salida.setValue(texto);
        }
        function Compile(texto){
            Salida.setValue("");
            treeData = [];
            var res = gramatica.parse(texto);
            console.log(res)
            console.log('entro')
            showTableErrors();
            var codigo = "";
            for(var e of res){
                codigo+=e+"\n";
            }
            /*if (document.getElementById("grafo")) {
                document.getElementById("grafo").remove();
            }*/
            Salida.setValue(codigo);
            //generateTree([res.node]);
            showTableErrorsSymbols();
        }

        document.getElementById('BtnCompilar').onclick = function (){
            var Codigo = Fuente.getValue();
            Compile(Codigo);
        }

        function newNode(yy, state, ...nodes) {
            const parent = getNonTerminal(yy, state);
            const children = [];
            for (let node of nodes) {
                node.parent = node.parent ? node.parent : parent;
                if (node.parent == parent) {
                    children.push(node);
                } else if (typeof node == 'string') {
                    children.push({
                        name: node,
                        parent,
                        children: []
                    });
                } else {
                    children.push({
                        name: node.parent,
                        parent,
                        children: [node]
                    });
                }
            }

            return {
                name: parent,
                parent: null,
                children
            }
        }

        function getNonTerminal(yy, state) {
            const simbolos = yy.parser.symbols_;
            const produccion = yy.parser.productions_[state];
            let nonTerminal = '';
            for (let sim in simbolos) {
                if (simbolos[sim] === produccion[0]) {
                    nonTerminal = sim;
                    break;
                }
            }
            return nonTerminal;
        }

        const templist = [];

        function getTemp() {
            const temp = `t${templist.length}`;
            templist.push(temp);
            return temp;
        }

        function showTableErrorsSymbols() {
            document.getElementById("ShowReportErrors").innerHTML = "";
        
            var html = "<h2>Reporte de Errores</h2>\n";
            html += '<table class="table table-dark" id="tableErrors">';
            html += '<thead class="thead-light">';
            html += "<tr>";
            html += '<th scope="col">#</th>';
            html += '<th scope="col">Linea</th>';
            html += '<th scope="col">Columna</th>';
            html += '<th scope="col">Tipo de Error</th>';
            html += '<th scope="col">Descripcion</th>';
            html += '<th scope="col">Entorno</th>';
            html += "</tr>";
            html += " </thead>";
            html += "<tbody>";
        
            var nodes = ErrorList.getErrorList();
            for (var i = 0; i < nodes.length; i++) {
            var item = nodes[i];
            html += "<tr>";
            html += `<td>${i + 1}</td>`;
            html += `<td>${item.line}</td>`;
            html += `<td>${item.column}</td>`;
            html += `<td>${item.errorType.toString()}</td>`;
            html += `<td>${item.description}</td>`;
            html += `<td>${item.environmentType.toString()}</td>`;
            html += "</tr>";
            }
        
            html += "</tbody>";
            html += "</table>";
            console.log(html);
            document.getElementById("ReportErrors").innerHTML = html;
        }
    function showTableErrors() {
        document.getElementById("tableErrors").innerHTML = "";

        var html = "<h2>Tabla de errores</h2>\n";
        html += '<table class="table table-dark" id="tableErrors">';
        html += '<thead class="thead-light">';
        html += "<tr>";
        html += '<th scope="col">#</th>';
        html += '<th scope="col">LINEA</th>';
        html += '<th scope="col">COLUMNA</th>';
        html += '<th scope="col">TIPO DE ERROR</th>';
        html += '<th scope="col">DESCRIPCION</th>';
        html += '<th scope="col">ENTORNO</th>';
        html += "</tr>";
        html += " </thead>";
        html += "<tbody>";

        var nodes = ErrorList.getErrorList();
        for (var i = 0; i < nodes.length; i++) {
            var item = nodes[i];
            html += "<tr>";
            html += `<td>${i + 1}</td>`;
            html += `<td>${item.line}</td>`;
            html += `<td>${item.column}</td>`;
            html += `<td>${item.errorType.toString()}</td>`;
            html += `<td>${item.description}</td>`;
            html += `<td>${item.environmentType.toString()}</td>`;
            html += "</tr>";
        }

        html += "</tbody>";
        html += "</table>";
        document.getElementById("tableErrors").innerHTML = html;
        }
    </script>
   

    <div id="root"></div>
  </body>
  <footer></footer>

</html>
